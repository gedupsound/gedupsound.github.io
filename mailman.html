<html>
	<head>
		<link rel="stylesheet" type="text/css" href="style.css">
	</head>
	<title>
		Gabe McGinnis - Mailman Script (Bash)
	</title>

	<body>
		<h1> <center> Mailman Script: Automating a Manual Process </center> </h1> <p>
		<p>
		Our team supports a Mailman list server, and while it just chugs along all on its own, I took an interest in learning more about the application.
    <p>
		<p>
    
    #!/bin/bash <br>
<br>
####################################################################################<br>
# <br>
# Created by: gabe@domain.com <br>
# <br>
# Purpose: Automate the process of adding Information Services staffmembers to <br>
#          important mailing lists for Information Services: <br>
# <br>
#	   Campus-IT-Professionals <br>
#          IS-Staff <br>
# <br>
# Requirements: ldapsearch enhancement is required for the syntax of the ldapsearch <br>
#               to function: unboundid-ldapsdk-3.0.0-se.zip and java  <br>
# <br>
# <br>
#################################################################################### <br>
 <br>
# Sourcing in the environment path to include the unboundid-ldapsdk path <br>
source ~/.bash_profile <br>
 <br>
 <br>
# Block list for users that should not be included in IS-related mailing lists that still reside in the IS OU <br>
 <br>
NOLIST="mattsonc@udomain.com" <br>
 <br>
 <br>
# LDAP query of IS OU Managd users <br>
 <br>
QUERY=$(ldapsearch \ <br>
 --hostname 'ad.uoregon.edu' \ <br>
 --port 636 \ <br>
 --useSSL --trustAll \ <br>
 --bindDN "CN=is-svc-listsmodify,OU=Service Accounts,OU=Unmanaged,OU=Users,OU=IS,OU=Units,DC=ad,DC=domain,DC=com" \ <br>
 --bindPassword '<PASSWORD>' \ <br>
 --baseDN 'OU=Managed,OU=Users,OU=IS,OU=Units,DC=ad,DC=domain,DC=com' \ <br>
 --scope sub "(|(UOAD-UoPersonAffiliation=staff)(UOAD-UoPersonAffiliation=administrative faculty))" UserPrincipalName | sed '/^dn:/d' | sed '/^#/d' | sed 's/userPrincipalName: //' | sed '/^$/d') <br>
 <br>
 <br>
# Reference for mailman cmds <br>
 <br>
# ITPROS=$(/usr/local/mailman/bin/list_members campus-it-professionals) <br>
# ISSTAFF=$(/usr/local/mailman/bin/list_members IS-Staff) <br>
# ADDISSTAFF=/usr/local/mailman/bin/add_members <br>
# ADDITPROS= <br>
 <br>
 <br>
# Conditional logic, looking for a user membership in IS groups, if they are not found to be members, they will be added to each respective group <br>
 <br>
 <br>
for USER in $QUERY <br>
do <br>
    #echo $USER  <br>
    # IS-Staff list query <br>
    if [ $(/usr/local/mailman/bin/list_members IS-Staff | grep $USER) ] <br>
    then <br>
        if [ "$(echo $NOLIST | grep $USER)" ] <br>
        then <br>
            echo "$USER found in IS-Staff, $USER found in NOLIST, removing from IS-Staff." <br>
            #mailman command <br>
        fi <br>
    else <br>
        if [ "$(echo $NOLIST | grep $USER)" ] <br>
        then <br>
            A=$(echo "$USER not found in IS-Staff, $USER found in NOLIST, no action required.") <br>
        else <br>
            echo "$USER not found in IS-Staff, not in NOLIST, adding $USER to IS-Staff" <br>
            #mailman command <br>
        fi <br>
    fi <br>
 <br>
    # Campus-IT-Professionals list query <br>
    if [ $(/usr/local/mailman/bin/list_members Campus-IT-Professionals | grep $USER) ] <br>
    then <br>
        if [ "$(echo $NOLIST | grep $USER)" ] <br>
        then <br>
            echo "$USER found in Campus-IT-Professionals, $USER found in NOLIST, removing from Campus-IT-Professionals." <br>
            #mailman command <br>
        fi <br>
    else <br>
        if [ "$(echo $NOLIST | grep $USER)" ] <br>
        then <br>
            B=$(echo "$USER not found in Campus-IT-Professionals, $USER found in NOLIST, no action required.") <br>
        else <br>
            echo "$USER not found in Campus-IT-Professionals, not in NOLIST, adding $USER to Campus-IT-Professionals." <br>
            #mailman command <br>
        fi <br>
    fi <br>
done <br> 
    <p>
	</body>
</html>
